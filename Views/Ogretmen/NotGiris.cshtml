@model List<OgrBilgiSistemi.Models.DersKayitlari>
@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <title>Not Girişi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>
        function notKaydet(btn, ogrenciId, dersId) {
            // Butonun olduğu satırı bulalım
            var row = btn.closest("tr");

            // Satırdaki inputları bulalım
            var vize = row.querySelector("input[name='vize']").value;
            var final = row.querySelector("input[name='final']").value;
            var but = row.querySelector("input[name='but']").value;

            // Gizli form oluştur ve göndereleım
            var form = document.createElement("form");
            form.method = "POST";
            form.action = "/Ogretmen/NotKaydet";

            var fields = {ogrenciId: ogrenciId, dersId: dersId, vize: vize, final: final, but: but};

            for (var key in fields) {
                var input = document.createElement("input");
                input.type = "hidden";
                input.name = key;
                input.value = fields[key];
                form.appendChild(input);
            }

            document.body.appendChild(form);
            form.submit();
        }
    </script>
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="card shadow">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h3 class="mb-0">@ViewBag.DersAdi - Not Giriş Ekranı</h3>
                <a href="/Ogretmen/Index" class="btn btn-light btn-sm">Geri Dön</a>
            </div>
            <div class="card-body">
                @if (TempData["Mesaj"] != null)
                {
                    <div class="alert alert-success">@TempData["Mesaj"]</div>
                }
                @if (TempData["Hata"] != null)
                {
                    <div class="alert alert-danger">@TempData["Hata"]</div>
                }

                <table class="table table-hover table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>No</th>
                            <th>Ad Soyad</th>
                            <th style="width: 80px;">Vize</th>
                            <th style="width: 80px;">Final</th>
                            <th style="width: 80px;">Büt</th>
                            <th>Ort</th>
                            <th>Harf</th>
                            <th>Durum</th>
                            <th>İşlem</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var kayit in Model)
                        {
                            <tr>
                                <td>@kayit.Ogrenci.OgrenciNo</td>
                                <td>@kayit.Ogrenci.Kullanici.Ad @kayit.Ogrenci.Kullanici.Soyad</td>
                                <td><input type="text" name="vize" value="@kayit.VizeNotu" class="form-control form-control-sm text-center" /></td>
                                <td><input type="text" name="final" value="@kayit.FinalNotu" class="form-control form-control-sm text-center" /></td>
                                <td><input type="text" name="but" value="@kayit.ButNotu" class="form-control form-control-sm text-center" placeholder="-" /></td>
                                <td class="fw-bold text-center">@kayit.Ortalama</td>
                                <td class="text-center"><span class="badge @(kayit.HarfNotu == "FF" ? "bg-danger" : "bg-success")">@kayit.HarfNotu</span></td>
                                <td class="text-center">@kayit.Durum</td>
                                <td>
                                    <button type="button" class="btn btn-success btn-sm w-100" onclick="notKaydet(this, @kayit.OgrenciId, @ViewBag.DersId)">Kaydet</button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>